<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>定点医药机构变更(医疗机构)</title>
    <link rel="stylesheet" href="./css/reset.css">
    <link rel="stylesheet" href="./css/onlineHandle.css">
</head>

<body>
    <iframe src="./PageHeader.html" style="width: 100%; height: 375px;" frameborder="0"></iframe>
    <div class="container">
        <!-- 事项信息开始 -->
        <div class="container_top">
            <div class="container_top_header">
                <div class="con_top_header_left"></div>
                <div class="con_top_header_center">事项信息</div>
                <div class="con_top_header_right"></div>
            </div>
            <div class="container_top_main">
                <table border="0">
                    <form action="">
                        <tr>
                            <td colspan="2">事项名称：<span id="matterNumber">医药机构变更(医疗机构)</span></td>
                        </tr>
                        <tr>
                            <td>办件类型：<span id="commitment">承诺件</span></td>
                            <td>受理部门：<span id="department">区人社局社保中心</span></td>
                        </tr>
                    </form>

                </table>
            </div>
        </div>
        <!-- 事项信息结束 -->
        <div class="clear"></div>
        <!-- 经办人信息开始 -->
        <div class="container_middle">
            <div class="container_middle_header">
                <div class="con_middle_header_left"></div>
                <div class="con_middle_header_center">经办人信息</div>
                <div class="con_middle_header_right"></div>
            </div>
            <div class="container_middle_main">
                <table border="0">
                    <form action="">
                        <tr>
                            <td>申请人：<span id="applicant"></span></td>
                            <td>身份证号：<span id="number"></span></td>
                        </tr>
                        <tr>
                            <td>联系电话：<span id="telephone"></span></td>
                            <td>单位名称：<span id="unit"></span></td>
                        </tr>
                    </form>
                </table>
            </div>
        </div>
        <!-- 经办人信息结束 -->
        <div class="clear"></div>
        <!-- 在线表格开始 -->
        <div class="container_top">
            <div class="container_top_header">
                <div class="con_top_header_left"></div>
                <div class="con_top_header_center">表格填写</div>
                <div class="con_top_header_right"></div>
            </div>
            <div class="container_top_main" id='tableSee'>
                <button>样表预览</button>
                <button onClick="Print('#mytable')">在线打印</button>
                <div class="light">
                    <div class="close">
                        关闭
                    </div>
                    <div class="picture">
                        <img src="./img/onlineHandleMedicalChange.PNG" alt="">
                    </div>
                </div>
                <div class="black_overlay"></div>
                <form action="" id="information">
                    <table border='0' id="mytable" cellspacing="0" cellpadding='0'>
                        <caption>医保信息变更申请表</caption>
                        <tr>
                            <td colspan="2" style='text-align:center;border:0;'>（单位盖章）</td>
                            <td colspan="8" style='text-align:right;border:0'>申请时间:<input type="text" style="border:none;width:60px " class='two'>年<input type="text" style="border:none;width:40px " class='two'>月<input type="text" style="border:none;width:40px " class='two'>日</td>

                        </tr>

                        <tbody id='medicalApply'>
                            <!-- <tr style="height:40px;opacity:0;">
                                <td colspan="2" style="padding-left:10px;border:0;height:40px">药店名称</td>
                                <td height="40" colspan="5" style="border:0;">
                                    <input type="text" style="height:80%; width:90%; border:0; outline:none; margin-left: 5px;" /></td>
                                <td width="127" height="40" style="padding-left:10px;border:0;">营业执照</td>
                                <td width="246" height="40" colspan="2" style="border:0;"><input type="text" style="height:80%; width:90%; border:0; outline:none; margin-left: 5px;" /></td>
                            </tr> -->
                            <!-- <tr>
                                <td colspan="2" style="padding-left:10px;height:40px">申请单位名称</td>
                                <td colspan="8"><input type="text" style="height:80%; width:98%; border:0; outline:none;" /></td>

                            </tr>
                            <tr>
                                <td colspan="2" style="padding-left:10px;height:40px">联系人姓名</td>
                                <td colspan="8"><input type="text" style="height:80%; width:98%; border:0; outline:none;" /></td>

                            </tr>
                            <tr>
                                <td colspan="2" style="padding-left:10px;height:40px">联系电话</td>
                                <td colspan="8"><input type="text" style="height:80%; width:98%; border:0; outline:none;" /></td>

                            </tr> -->
                            <!-- <tr>
                                <td colspan="10" style="height:40px">在需要变更的内容后打“√”</td>
                            </tr> -->
                            <tr>
                                <td colspan="2" style="height:40px"></td>
                                <td colspan="6" style="height:40px">变更前</td>
                                <td colspan="2" style="height:40px">变更后</td>
                            </tr>
                            <tr>
                                <td colspan="2" style="height:40px">单位名称</td>
                                <td colspan="6" style="height:40px"><input type="text" id="oldHospitalName" style="height:80%; width:90%; border:0; outline:none; margin-left: 5px;" /></td>
                                <td colspan="2" style="height:40px"><input type="text" id="hospitalName" style="height:80%; width:90%; border:0; outline:none; margin-left: 5px;" /></td>
                            </tr>
                            <tr>
                                <td colspan="2" style="height:40px">单位负责人</td>
                                <td colspan="6" style="height:40px"><input type="text" id="oldHospitalMaster" style="height:80%; width:90%; border:0; outline:none; margin-left: 5px;" /></td>
                                <td colspan="2" style="height:40px"><input type="text" id="hospitalMaster" style="height:80%; width:90%; border:0; outline:none; margin-left: 5px;" /></td>
                            </tr>
                            <tr>
                                <td colspan="2" style="height:40px">质量名称</td>
                                <td colspan="6" style="height:40px"><input type="text" id="oldQualityMaster" style="height:80%; width:90%; border:0; outline:none; margin-left: 5px;" /></td>
                                <td colspan="2" style="height:40px"><input type="text" id="qualityMaster" style="height:80%; width:90%; border:0; outline:none; margin-left: 5px;" /></td>
                            </tr>
                            <tr>
                                <td colspan="2" style="height:40px">单位地址</td>
                                <td colspan="6" style="height:40px"><input type="text" id="oldHospitalAddress" style="height:80%; width:90%; border:0; outline:none; margin-left: 5px;" /></td>
                                <td colspan="2" style="height:40px"><input type="text" id="hospitalAddress" style="height:80%; width:90%; border:0; outline:none; margin-left: 5px;" /></td>
                            </tr>
                            <tr>
                                <td align="center">
                                    <p>考察情况记录</p>

                                </td>
                                <td height="150" colspan="9" align="left" style="border-bottom:1px solid #000;">
                                    <!-- <textarea style="height:90%; width:98%; border:none; outline:none; resize: none; margin-left: 5px;" name="" cols="" rows="6"></textarea> -->

                                </td>
                            </tr>

                            <tr>
                                <td rowspan="2" align="center">
                                    <p>审批结果</p>

                                </td>
                                <td height="150" colspan="9" align="left" style="border-bottom:1px solid #FFF;">
                                    <!-- <textarea style="height:90%; width:98%; border:none; outline:none; resize: none; margin-left: 5px;" name="" cols="" rows="6"></textarea> -->
                                </td>
                            </tr>
                            <tr>
                                <td height="80" colspan="9" align="right" style="text-align: right;">
                                    <span style="margin-right: 20px;">年</span><span style="margin-right: 20px;">月</span><span>日</span>
                                </td>
                            </tr>

                        </tbody>
                    </table>
                </form>
            </div>
        </div>
        <!-- 在线表格结束 -->
        <div class="clear"></div>
        <!-- 申报材料开始 -->
        <div class="container_footer">
            <div class="container_footer_header">
                <div class="container_footer_header_left"></div>
                <div class="container_footer_header_center">申报材料</div>
                <div class="container_footer_header_right"></div>
            </div>
            <div class="container_footer_main">
                <form id="uploadForm" enctype="multipart/form-data">
                    <table border="0">
                        <thead>
                            <tr>
                                <th style="width: 35%;">材料名称</th>
                                <th style="width: 30%;">材料上传</th>
                                <th style="width: 20%;">表格下载</th>
                                <th>是否必须</th>
                                <!-- <th style="width: 40px;">操作</th> -->
                            </tr>
                        </thead>
                        <tbody>

                        </tbody>
                    </table>
                </form>
            </div>
        </div>
        <!-- 申报材料结束 -->
    </div>
    <iframe src="./PageFooter.html" style="width: 100%; height: 210px;" scrolling="no" frameborder="0"></iframe>
    <script src='./js/jquery-1.10.2.min.js'></script>
    <script src='./lib/jquery.cookie.js'></script>
    <script src="./js/Print.js"></script>
    <script src="./js/domainName.js"></script>
    <script>
        var userInfo = JSON.parse($.cookie('PHPSESSID'));
        console.log('userInfo=', userInfo);
        var contactPhone = userInfo.ownerCompany.contactPhone,
            masterId = userInfo.ownerCompany.masterId;
        var phone = contactPhone.substring(0, 3) + "*****" + contactPhone.substring(8, 11);
        var num = masterId.substring(0, 1) + "****************" + masterId.substring(17, 18); //身份证加密

        $('#applicant').html(userInfo.ownerCompany.contactName);
        $('#number').html(num);
        $('#telephone').html(phone);
        $('#unit').html(userInfo.ownerCompany.companyName);

        $(function() {
            $('#tableSee  button:first-child').on('click', function() {
                // $(this).siblings().css('display', 'block')
                $('.light').css('display', 'block');
                $('.black_overlay').css('display', 'block')
            });
            $('.close').on('click', function() {
                $(this).parent().css('display', 'none');
                $(this).parent().next().css('display', 'none');
            }).on('mouseover', function() {
                $(this).css('color', '#e60c17')
            }).on('mouseout', function() {
                $(this).css('color', '')
            })
            $('.light').attr('style', 'overflow-x:hidden')
        })


        var parameter = {
            "serviceCode": "12"
        }
        var arr = [];
        var res;
        console.log('parameter=', parameter);
        $.ajax({
            type: 'POST',
            url: ipAddress + '/service/detailProcedure',
            data: JSON.stringify(parameter),
            contentType: 'application/json;charset=UTF-8',
            success: function(result) {
                res = result;
                var html = '';
                $('table:last thead').next('tbody').remove();
                console.log('result=', result);
                console.log('result=', result.serviceAttachModels.length);
                for (var i = 0; i < result.serviceAttachModels.length; i++) {
                    arr.push(result.serviceAttachModels[i].attachName);
                    html += '<tr>' +
                        '<td style="padding-right: 10px;">' + result.serviceAttachModels[i].attachName +
                        '</td>' +
                        '<td><input class="file" type="file" name="key_' + (i + 1) + '" accept="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel,image/*,application/pdf,application/msword">' +
                        '</td>' +
                        '<td>' + (result.serviceAttachModels[i].attachFrom != null && result.serviceAttachModels[i].attachFrom != '' ? '<a href="./medicalApply1.html#sheet?serviceCode=' + result.serviceCode + '">' + result.serviceAttachModels[i].attachName + '</a>' : '') +
                        '</td>' +
                        '<td>' + (result.serviceAttachModels[i].attachStatus == 1 ? '是' : '否') +
                        '</td>' +
                        // '<td>修改' +
                        // '</td>' +
                        '</tr>'
                }
                html += '<tr>' +
                    '<td colspan="4">' +
                    '<button type="button" class="submit" id="submits" onclick="doUpload()">提交</button>' +
                    '</td>' +
                    '</tr>';
                $('table:last').append(html);
                console.log('arr=', arr);
                console.log('arr11=', arr.toString());
            },
            error: function() {
                alert('失败')
            }
        })

        function doUpload() {
            for (var i = 0; i < res.serviceAttachModels.length; i++) {
                if (res.serviceAttachModels[i].attachStatus == 1) {
                    if ($(".file").eq(i).val() == '') {
                        alert('必选材料不能为空!')
                        return false
                    }
                }
            }

            var parameter = {
                "serviceCode": "12",
                "userCode": userInfo.userCode,
                "serviceType": "04"
            }
            var parameter2 = {
                "oldHospitalName": $('#oldHospitalName').val(),
                "hospitalName": $('#hospitalName').val(),
                "oldHospitalMaster": $('#oldHospitalMaster').val(),
                "hospitalMaster": $('#hospitalMaster').val(),
                "oldQualityMaster": $('#oldQualityMaster').val(),
                "qualityMaster": $('#qualityMaster').val(),
                "oldHospitalAddress": $('#oldHospitalAddress').val(),
                "hospitalAddress": $('#hospitalAddress').val()
            }
            var formData = new FormData($("#uploadForm")[0]);
            formData.append("masterVO", JSON.stringify(parameter)); // 经办人信息
            formData.append("detailVO", JSON.stringify(parameter2)); // 表单信息
            formData.append("filesMapping", arr.toString()); // 拼接数组

            $.ajax({
                type: 'POST',
                url: ipAddress + '/service/addHospitalAlter',
                data: formData,
                async: false,
                cache: false,
                contentType: false,
                processData: false,
                success: function(result) {
                    console.log('result=', result);
                    if (result.code == 3020) {
                        alert('提交成功');
                        location.href = './office.html';
                        document.getElementById('uploadForm').reset();
                        document.getElementById('information').reset();
                    } else {
                        alert('提交失败')
                    }
                },
                error: function() {
                    alert('失败');
                    document.getElementById('uploadForm').reset();
                    document.getElementById('information').reset();
                }
            })
        }
    </script>
</body>

</html>