<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>居民医保报销进度查询</title>
    <link rel="stylesheet" href="./css/reset.css">
    <link rel="stylesheet" href="./css/fileInquiries.css">
    <style>
        .instructions table {
            border-collapse: collapse;
        }
        
        .instructions table tr {
            height: 40px;
        }
        
        .instructions table tr td {
            background-color: #f5f5f5;
        }
        
        .chaxun {
            height: 30px;
            width: 45px;
            background-color: #00b8ee;
            border: none;
            border-radius: 5px;
            color: #ffffff;
        }
        
        .chaxun:hover {
            color: #000000;
            background-color: #34CBFA;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <iframe src="./PageHeader.html" style="width: 100%; height: 375px;" frameborder="0"></iframe>
    <div class="container">
        <!-- 查询列表开始 -->
        <div class="container_left">
            <aside>
                <ul>
                    <!-- <a href="./publicQuery.html" target="_blank">
                        <li>岗位查询</li>
                    </a> -->
                    <a href="./fileInquiries.html">
                        <li>流动人员档案查询</li>
                    </a>
                    <a href="./medicalInstitution.html">
                        <li>定点医疗机构查询</li>
                    </a>
                    <a href="./ginseng.html">
                        <li>城乡居民个人参保信息查询</li>
                    </a>
                    <a href="./progress.html" class="active">
                        <li>居民医保报销进度查询</li>
                    </a>
                    <!-- <a href="#" target="_blank">
                        <li>社保卡服务网点查询</li>
                    </a>
                    <a href="#">
                        <li>岗位查询</li>
                    </a>
                    <a href="#">
                        <li>岗位查询</li>
                    </a>
                    <a href="#">
                        <li>岗位查询</li>
                    </a>
                    <a href="#">
                        <li>岗位查询</li>
                    </a>
                    <a href="#">
                        <li>岗位查询</li>
                    </a> -->
                </ul>
            </aside>
        </div>
        <!-- 查询列表技结束 -->

        <!-- 信息查询开始 -->
        <div class="container_right">
            <div class="con_right_top">
                <p>您当前的位置：<a href="#">大厅首页</a> >> 公共查询>>居民医保报销进度查询</p>
            </div>
            <div class="con_right_middle">
                <p><img src="./img/postQuery.png" />居民医保报销进度查询</p>
                <div class="search">
                    <div class="instructions">
                        <form id="form1">
                            <table>
                                <tr>
                                    <td style="text-align: right;">姓名：</td>
                                    <td style="text-align: left;"><input type="text" name="" id="userName"></li>
                                    </td>
                                    <td style="text-align: right;">身份证号：</td>
                                    <td style="text-align: left;"><input type="text" name="" id="idNumber"></li>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="text-align: right;">验证码：</td>
                                    <td style="text-align: left;"><input type="text" name="" id="input"><input style="height: 27px; background-color: #DDDDDD;" type="button" id="checkCode" class="code" onclick="createCode()" /></td>
                                    <td></td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <td colspan="4" style="height: 60px;">
                                        <button type="button" onclick="validate()" class="chaxun" style="outline: none;">查询</button>
                                        <button type="button" onclick="formReset()" class="chaxun" style="outline: none;">重置</button>
                                    </td>
                                </tr>
                            </table>
                        </form>
                    </div>
                </div>
                <div class="clear"></div>
                <div class="postList">
                    <div class="maintab">
                        <p>结果公示</p>
                        <table border="0" cellspacing="1" cellpadding="2">
                            <thead>
                                <th>个人编号</th>
                                <th>姓名</th>
                                <th>状态</th>
                            </thead>
                            <tbody>
                                <!-- <tr>
                                    <td>001</td>
                                    <td>张三</td>
                                    <td>材料受理</td>
                                </tr>
                                <tr>
                                    <td>001</td>
                                    <td>张三</td>
                                    <td>材料审核</td>
                                </tr>
                                <tr>
                                    <td>001</td>
                                    <td>张三</td>
                                    <td>报销完成</td>
                                </tr> -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <!-- 信息查询结束 -->
        <div class="clear"></div>
    </div>
    <iframe src="./PageFooter.html" style="width: 100%; height: 210px;" scrolling="no" frameborder="0"></iframe>
    <script src="./js/jquery-1.10.2.min.js"></script>
    <script src="./js/domainName.js"></script>
    <script>
        function formReset() {
            var form1 = document.getElementById('form1').reset();
            createCode();
        }

        var code; //在全局定义验证码      
        //产生验证码     
        window.onload = function() {
            createCode();
        }

        function createCode() {
            code = "";
            var codeLength = 4; //验证码的长度     
            var checkCode = document.getElementById("checkCode");
            var random = new Array(0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R',
                'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z'); //随机数     
            for (var i = 0; i < codeLength; i++) { //循环操作     
                var charIndex = Math.floor(Math.random() * 36); //取得随机数的索引     
                code += random[charIndex]; //根据索引取得随机数加到code上     
            }
            checkCode.value = code; //把code值赋给验证码     
        }
        //校验验证码     
        function validate() {
            var userName = $('#userName').val();
            var idNumber = $('#idNumber').val();
            if (userName != '' && idNumber != '') {
                var reg = /(^\d{18}$)|(^\d{17}(\d|X|x)$)/;
                if (reg.test(idNumber) === false) {
                    alert('身份证输入不合法');
                    return false;
                }
                var inputCode = document.getElementById("input").value.toUpperCase(); //取得输入的验证码并转化为大写           
                if (inputCode.length <= 0) { //若输入的验证码长度为0     
                    alert("请输入验证码！"); //则弹出请输入验证码   
                    createCode();
                } else if (inputCode != code) { //若输入的验证码与产生的验证码不一致时     
                    alert("验证码输入错误！"); //则弹出验证码输入错误     
                    createCode(); //刷新验证码 
                } else {
                    var parameter = {
                        "pageIndex": 1,
                        "recordCount": 5,
                        "criteria": {
                            "insuranceName": $('#userName').val(),
                            "insuranceIdentity": $('#idNumber').val()
                        }
                    }
                    console.log('parameter=', parameter);
                    $.ajax({
                        type: 'POST',
                        url: ipAddress + '/inquiry/queryProgress',
                        data: JSON.stringify(parameter),
                        contentType: 'application/json;charset=UTF-8',
                        success: function(result) {
                            var html = '';
                            console.log('result=', result);
                            if (result.data.length != 0) {
                                $('table thead').siblings().remove();
                                for (var i = 0; i < result.data.length; i++) {
                                    if (result.data[i].materialStatus == 0) {
                                        html += '<tr>' +
                                            '<td>' + result.data[i].insuranceCode +
                                            '</td>' +
                                            '<td>' + result.data[i].insuranceName +
                                            '</td>' +
                                            '<td>材料受理' +
                                            '</td>' +
                                            '</tr>'
                                    } else if (result.data[i].materialStatus == 1) {
                                        html += '<tr>' +
                                            '<td>' + result.data[i].insuranceCode +
                                            '</td>' +
                                            '<td>' + result.data[i].insuranceName +
                                            '</td>' +
                                            '<td>材料审核' +
                                            '</td>' +
                                            '</tr>'
                                    } else if (result.data[i].materialStatus == 2) {
                                        html += '<tr>' +
                                            '<td>' + result.data[i].insuranceCode +
                                            '</td>' +
                                            '<td>' + result.data[i].insuranceName +
                                            '</td>' +
                                            '<td>报销完成' +
                                            '</td>' +
                                            '</tr>'
                                    } else {
                                        html += '<tr>' +
                                            '<td>' + result.data[i].insuranceCode +
                                            '</td>' +
                                            '<td>' + result.data[i].insuranceName +
                                            '</td>' +
                                            '<td>报销失败' +
                                            '</td>' +
                                            '</tr>'
                                    }
                                }
                                $('table:last').append(html);
                            } else {
                                alert('没有该信息!')
                            }

                        },
                        error: function() {
                            alert('失败')
                        }
                    })
                }

            } else {
                alert('姓名或身份证号不能为空');
            }

        }
    </script>
</body>

</html>