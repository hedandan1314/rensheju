<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>城乡居民个人参保信息查询</title>
    <link rel="stylesheet" href="./css/reset.css">
    <link rel="stylesheet" href="./css/fileInquiries.css">
    <style>
        .instructions table {
            border-collapse: collapse;
        }
        
        .instructions table tr {
            height: 40px;
        }
        
        .instructions table tr td {
            background-color: #f5f5f5;
        }
        
        .chaxun {
            height: 30px;
            width: 45px;
            background-color: #00b8ee;
            border: none;
            border-radius: 5px;
            color: #ffffff;
        }
        
        .chaxun:hover {
            color: #000000;
            background-color: #c0dffa;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <iframe src="./PageHeader.html" style="width: 100%; height: 375px;" scrolling="no" frameborder="0"></iframe>
    <div class="container">
        <!-- 查询列表开始 -->
        <div class="container_left">
            <aside>
                <ul>
                    <!-- <a href="./publicQuery.html" target="_blank">
                        <li>岗位查询</li>
                    </a> -->
                    <a href="./fileInquiries.html">
                        <li>流动人员档案查询</li>
                    </a>
                    <a href="./medicalInstitution.html">
                        <li>定点医疗机构查询</li>
                    </a>
                    <a href="./ginseng.html" class="active">
                        <li>城乡居民个人参保信息查询</li>
                    </a>
                    <a href="./progress.html">
                        <li>居民医保报销进度查询</li>
                    </a>
                    <!-- <a href="#" target="_blank">
                        <li>社保卡服务网点查询</li>
                    </a>
                    <a href="#">
                        <li>岗位查询</li>
                    </a>
                    <a href="#">
                        <li>岗位查询</li>
                    </a>
                    <a href="#">
                        <li>岗位查询</li>
                    </a>
                    <a href="#">
                        <li>岗位查询</li>
                    </a>
                    <a href="#">
                        <li>岗位查询</li>
                    </a> -->
                </ul>
            </aside>
        </div>
        <!-- 查询列表技结束 -->

        <!-- 信息查询开始 -->
        <div class="container_right">
            <div class="con_right_top">
                <p>您当前的位置：<a href="#">大厅首页</a> >> 公共查询>>城乡居民个人参保信息查询</p>
            </div>
            <div class="con_right_middle">
                <p><img src="./img/postQuery.png" />城乡居民个人参保信息查询</p>
                <div class="search">
                    <div class="instructions">
                        <form id="form1">
                            <table>
                                <tr>
                                    <td style="text-align: right;">姓名：</td>
                                    <td style="text-align: left;"><input type="text" name="" id="personName" value=""></li>
                                    </td>
                                    <td style="text-align: right;">身份证号：</td>
                                    <td style="text-align: left;"><input type="text" name="" id="iDNumber" value=""></li>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="text-align: right;">验证码：</td>
                                    <td style="text-align: left;"><input type="text" name="" id="input"><input style="height: 27px; background-color: #DDDDDD;" type="button" id="checkCode" class="code" onclick="createCode()" /></td>
                                    <td></td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <td colspan="4" style="height: 60px;">
                                        <button type="button" onclick="validate()" class="chaxun" style="outline: none;">查询</button>
                                        <button type="button" onclick="formReset()" class="chaxun" style="outline: none;">重置</button>
                                    </td>
                                </tr>
                            </table>
                        </form>
                    </div>
                </div>
                <div class="clear"></div>
                <div class="postList">
                    <div class="maintab">
                        <p>结果公示</p>
                        <table border="0" cellspacing="1" cellpadding="2">
                            <thead>
                                <th>所属村/居委会</th>
                                <th>年月</th>
                                <th>养老保险</th>
                                <th>医疗保险</th>
                                <th>失业保险</th>
                                <th>工商保险</th>
                                <th>生育保险</th>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <!-- 信息查询结束 -->
        <div class="clear"></div>
    </div>
    <iframe src="./PageFooter.html" style="width: 100%; height: 210px;" scrolling="no" frameborder="0"></iframe>
    <script src="./js/jquery-1.10.2.min.js"></script>
    <script src="./js/domainName.js"></script>
    <script>
        var code; //在全局定义验证码      
        //产生验证码     
        window.onload = function() {
            createCode();
        }

        function createCode() {
            code = "";
            var codeLength = 4; //验证码的长度     
            var checkCode = document.getElementById("checkCode");
            var random = new Array(0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R',
                'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z'); //随机数     
            for (var i = 0; i < codeLength; i++) { //循环操作     
                var charIndex = Math.floor(Math.random() * 36); //取得随机数的索引     
                code += random[charIndex]; //根据索引取得随机数加到code上     
            }
            checkCode.value = code; //把code值赋给验证码     
        }

        function formReset() {
            var form1 = document.getElementById('form1').reset();
            createCode();
        }

        // 初始化数据
        function validate() {
            var personName = $.trim($('#personName').val());
            var iDNumber = $.trim($('#iDNumber').val());

            var parameter = {
                'pageIndex': 1,
                'criteria': {
                    'insuredPerson': personName,
                    'personIdentity': iDNumber
                }
            }

            var reg = /(^\d{18}$)|(^\d{17}(\d|X|x)$)/; // 验证身份证
            if (personName != '' && iDNumber != '') {
                if (!reg.test(iDNumber)) {
                    alert('身份证输入不合法!');
                    $('table:last thead').siblings().remove();
                    return false;
                }

                // 校验验证码 
                var inputCode = document.getElementById("input").value.toUpperCase(); //取得输入的验证码并转化为大写           
                if (inputCode.length <= 0) { //若输入的验证码长度为0     
                    alert("请输入验证码！"); //则弹出请输入验证码     
                } else if (inputCode != code) { //若输入的验证码与产生的验证码不一致时     
                    alert("验证码输入错误！"); //则弹出验证码输入错误     
                    createCode(); //刷新验证码     
                } else { //输入正确时     
                    console.log('parameter=', parameter);
                    $.ajax({
                        type: 'POST',
                        url: ipAddress + '/inquiry/queryInsurance',
                        data: JSON.stringify(parameter),
                        contentType: 'application/json;charset=UTF-8',
                        success: function(result) {
                            console.log('result=', result);
                            var html = '';
                            if (result.data.length != 0) {
                                $('table:last thead').siblings().remove();
                                for (var i = 0; i < result.data.length; i++) {
                                    html += '<tr>' +
                                        '<td>' + result.data[i].memberPlace +
                                        '</td>' +
                                        '<td>' + result.data[i].paymentMonth +
                                        '</td>' +
                                        '<td>' + result.data[i].insurancePension +
                                        '</td>' +
                                        '<td>' + result.data[i].insuranceMedical +
                                        '</td>' +
                                        '<td>' + result.data[i].insuranceUnemploy +
                                        '</td>' +
                                        '<td>' + result.data[i].insuranceInjury +
                                        '</td>' +
                                        '<td>' + result.data[i].insuranceBirth +
                                        '</td>' +
                                        '</tr>'
                                }
                                $('table:last').append(html);
                            } else {
                                alert('没有该信息!')
                            }
                        },
                        error: function() {
                            alert('失败')
                        }
                    })
                }
            } else {
                alert('姓名或身份证号不能为空');
            }
        }
    </script>
</body>

</html>